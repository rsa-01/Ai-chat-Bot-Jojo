"use strict";var G=Object.defineProperty;var ne=Object.getOwnPropertyDescriptor;var se=Object.getOwnPropertyNames;var oe=Object.prototype.hasOwnProperty;var ie=(e,r)=>{for(var t in r)G(e,t,{get:r[t],enumerable:!0})},ae=(e,r,t,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let s of se(r))!oe.call(e,s)&&s!==t&&G(e,s,{get:()=>r[s],enumerable:!(n=ne(r,s))||n.enumerable});return e};var ue=e=>ae(G({},"__esModule",{value:!0}),e);var ve={};ie(ve,{DEFAULT_PERIOD:()=>H,MAX_COUNTER:()=>J,MAX_PERIOD:()=>j,MAX_SECRET_BYTES:()=>F,MAX_WINDOW:()=>K,MIN_PERIOD:()=>V,MIN_SECRET_BYTES:()=>q,RECOMMENDED_SECRET_BYTES:()=>z,bytesToString:()=>we,constantTimeEqual:()=>_e,counterToBytes:()=>he,createGuardrails:()=>le,dynamicTruncate:()=>Oe,generateSecret:()=>Pe,getDigestSize:()=>Ae,hasGuardrailOverrides:()=>Ee,normalizeCounterTolerance:()=>Z,normalizeEpochTolerance:()=>Re,normalizeSecret:()=>Ie,requireBase32Plugin:()=>L,requireBase32String:()=>Ne,requireCryptoPlugin:()=>ee,requireIssuer:()=>Ce,requireLabel:()=>ye,requireSecret:()=>Me,stringToBytes:()=>$,truncateDigits:()=>Se,validateByteLengthEqual:()=>Q,validateCounter:()=>xe,validateCounterTolerance:()=>ge,validateEpochTolerance:()=>be,validatePeriod:()=>me,validateSecret:()=>de,validateTime:()=>fe,validateToken:()=>Te,wrapResult:()=>Be,wrapResultAsync:()=>De});module.exports=ue(ve);var o=class extends Error{constructor(r,t){super(r,t),this.name="OTPError"}},x=class extends o{constructor(r){super(r),this.name="SecretError"}},f=class extends x{constructor(r,t){super(`Secret must be at least ${r} bytes (${r*8} bits), got ${t} bytes`),this.name="SecretTooShortError"}},m=class extends x{constructor(r,t){super(`Secret must not exceed ${r} bytes, got ${t} bytes`),this.name="SecretTooLongError"}},E=class extends o{constructor(r){super(r),this.name="CounterError"}},T=class extends E{constructor(){super("Counter must be non-negative"),this.name="CounterNegativeError"}},d=class extends E{constructor(){super("Counter exceeds maximum safe integer value"),this.name="CounterOverflowError"}},g=class extends E{constructor(){super("Counter must be a finite integer"),this.name="CounterNotIntegerError"}},b=class extends o{constructor(r){super(r),this.name="TimeError"}},h=class extends b{constructor(){super("Time must be non-negative"),this.name="TimeNegativeError"}},O=class extends b{constructor(){super("Time must be a finite number"),this.name="TimeNotFiniteError"}},S=class extends o{constructor(r){super(r),this.name="PeriodError"}},_=class extends S{constructor(r){super(`Period must be at least ${r} second(s)`),this.name="PeriodTooSmallError"}},A=class extends S{constructor(r){super(`Period must not exceed ${r} seconds`),this.name="PeriodTooLargeError"}};var w=class extends o{constructor(r){super(r),this.name="TokenError"}},I=class extends w{constructor(r,t){super(`Token must be ${r} digits, got ${t}`),this.name="TokenLengthError"}},P=class extends w{constructor(){super("Token must contain only digits"),this.name="TokenFormatError"}};var c=class extends o{constructor(r){super(r),this.name="CounterToleranceError"}},R=class extends c{constructor(r,t){super(`Counter tolerance validation failed: total checks (${t}) exceeds MAX_WINDOW (${r})`),this.name="CounterToleranceTooLargeError"}},M=class extends c{constructor(){super("Counter tolerance cannot contain negative values"),this.name="CounterToleranceNegativeError"}},p=class extends o{constructor(r){super(r),this.name="EpochToleranceError"}},y=class extends p{constructor(){super("Epoch tolerance cannot contain negative values"),this.name="EpochToleranceNegativeError"}},C=class extends p{constructor(r,t){super(`Epoch tolerance must not exceed ${r} seconds, got ${t}. Large tolerances can cause performance issues.`),this.name="EpochToleranceTooLargeError"}},N=class extends o{constructor(r){super(r),this.name="PluginError"}},B=class extends N{constructor(){super("Crypto plugin is required."),this.name="CryptoPluginMissingError"}},D=class extends N{constructor(){super("Base32 plugin is required."),this.name="Base32PluginMissingError"}},i=class extends o{constructor(r){super(r),this.name="ConfigurationError"}},v=class extends i{constructor(){super("Secret is required. Use generateSecret() to create one, or provide via { secret: 'YOUR_BASE32_SECRET' }"),this.name="SecretMissingError"}},X=class extends i{constructor(){super("Label is required for URI generation. Example: { label: 'user@example.com' }"),this.name="LabelMissingError"}},U=class extends i{constructor(){super("Issuer is required for URI generation. Example: { issuer: 'MyApp' }"),this.name="IssuerMissingError"}},Y=class extends i{constructor(){super("Class API requires secret to be a Base32 string, not Uint8Array. Use generateSecret() or provide a Base32-encoded string."),this.name="SecretTypeError"}};var ce=new TextEncoder,pe=new TextDecoder,q=16,F=64,z=20,V=1,j=3600,H=30,J=Number.MAX_SAFE_INTEGER,K=99,W=Symbol("otplib.guardrails.override");function l(e,r,t){if(typeof r!="number"||!Number.isSafeInteger(r))throw new i(`Guardrail '${e}' must be a safe integer`);if(r<t)throw new i(`Guardrail '${e}' must be >= ${t}`)}var u=Object.freeze({MIN_SECRET_BYTES:q,MAX_SECRET_BYTES:F,MIN_PERIOD:V,MAX_PERIOD:j,MAX_COUNTER:J,MAX_WINDOW:K,[W]:!1});function le(e){if(!e)return u;e.MIN_SECRET_BYTES!==void 0&&l("MIN_SECRET_BYTES",e.MIN_SECRET_BYTES,1),e.MAX_SECRET_BYTES!==void 0&&l("MAX_SECRET_BYTES",e.MAX_SECRET_BYTES,1),e.MIN_PERIOD!==void 0&&l("MIN_PERIOD",e.MIN_PERIOD,1),e.MAX_PERIOD!==void 0&&l("MAX_PERIOD",e.MAX_PERIOD,1),e.MAX_COUNTER!==void 0&&l("MAX_COUNTER",e.MAX_COUNTER,0),e.MAX_WINDOW!==void 0&&l("MAX_WINDOW",e.MAX_WINDOW,1);let r={...u,...e};if(r.MIN_SECRET_BYTES>r.MAX_SECRET_BYTES)throw new i("Guardrail 'MIN_SECRET_BYTES' must be <= 'MAX_SECRET_BYTES'");if(r.MIN_PERIOD>r.MAX_PERIOD)throw new i("Guardrail 'MIN_PERIOD' must be <= 'MAX_PERIOD'");return Object.freeze({...r,[W]:!0})}function Ee(e){return e[W]??!1}function de(e,r=u){if(e.length<r.MIN_SECRET_BYTES)throw new f(r.MIN_SECRET_BYTES,e.length);if(e.length>r.MAX_SECRET_BYTES)throw new m(r.MAX_SECRET_BYTES,e.length)}function xe(e,r=u){if(typeof e=="number"){if(!Number.isFinite(e)||!Number.isInteger(e))throw new g;if(!Number.isSafeInteger(e))throw new d}let t=typeof e=="bigint"?e:BigInt(e);if(t<0n)throw new T;if(t>BigInt(r.MAX_COUNTER))throw new d}function fe(e){if(!Number.isFinite(e))throw new O;if(e<0)throw new h}function me(e,r=u){if(!Number.isInteger(e)||e<r.MIN_PERIOD)throw new _(r.MIN_PERIOD);if(e>r.MAX_PERIOD)throw new A(r.MAX_PERIOD)}function Te(e,r){if(e.length!==r)throw new I(r,e.length);if(!/^\d+$/.test(e))throw new P}function ge(e,r=u){let[t,n]=Z(e);if(!Number.isSafeInteger(t)||!Number.isSafeInteger(n))throw new c("Counter tolerance values must be safe integers");if(t<0||n<0)throw new M;let s=t+n+1;if(s>r.MAX_WINDOW)throw new R(r.MAX_WINDOW,s)}function be(e,r=H,t=u){let[n,s]=Array.isArray(e)?e:[e,e];if(!Number.isSafeInteger(n)||!Number.isSafeInteger(s))throw new p("Epoch tolerance values must be safe integers");if(n<0||s<0)throw new y;let a=(t.MAX_WINDOW-1)*r,k=n+s;if(k>a)throw new C(a,k)}function he(e){let r=typeof e=="bigint"?e:BigInt(e),t=new ArrayBuffer(8);return new DataView(t).setBigUint64(0,r,!1),new Uint8Array(t)}function Oe(e){let r=e[e.length-1]&15;return(e[r]&127)<<24|e[r+1]<<16|e[r+2]<<8|e[r+3]}function Se(e,r){let t=10**r;return(e%t).toString().padStart(r,"0")}function Q(e,r){return e.length===r.length}function _e(e,r){let t=$(e),n=$(r);if(!Q(t,n))return!1;let s=0;for(let a=0;a<t.length;a++)s|=t[a]^n[a];return s===0}function Ae(e){switch(e){case"sha1":return 20;case"sha256":return 32;case"sha512":return 64}}function $(e){return typeof e=="string"?ce.encode(e):e}function we(e){return pe.decode(e)}function Ie(e,r){return typeof e=="string"?(L(r),r.decode(e)):e}function Pe(e){let{crypto:r,base32:t,length:n=z}=e;ee(r),L(t);let s=r.randomBytes(n);return t.encode(s,{padding:!1})}function Z(e=0){return Array.isArray(e)?e:[0,e]}function Re(e=0){return Array.isArray(e)?e:[e,e]}function ee(e){if(!e)throw new B}function L(e){if(!e)throw new D}function Me(e){if(!e)throw new v}function ye(e){if(!e)throw new X}function Ce(e){if(!e)throw new U}function Ne(e){if(typeof e!="string")throw new Y}function re(e){return{ok:!0,value:e}}function te(e){return{ok:!1,error:e}}function Be(e){return(...r)=>{try{return re(e(...r))}catch(t){return te(t)}}}function De(e){return async(...r)=>{try{return re(await e(...r))}catch(t){return te(t)}}}0&&(module.exports={DEFAULT_PERIOD,MAX_COUNTER,MAX_PERIOD,MAX_SECRET_BYTES,MAX_WINDOW,MIN_PERIOD,MIN_SECRET_BYTES,RECOMMENDED_SECRET_BYTES,bytesToString,constantTimeEqual,counterToBytes,createGuardrails,dynamicTruncate,generateSecret,getDigestSize,hasGuardrailOverrides,normalizeCounterTolerance,normalizeEpochTolerance,normalizeSecret,requireBase32Plugin,requireBase32String,requireCryptoPlugin,requireIssuer,requireLabel,requireSecret,stringToBytes,truncateDigits,validateByteLengthEqual,validateCounter,validateCounterTolerance,validateEpochTolerance,validatePeriod,validateSecret,validateTime,validateToken,wrapResult,wrapResultAsync});
//# sourceMappingURL=utils.cjs.map